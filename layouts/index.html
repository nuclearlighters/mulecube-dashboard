{{ define "main" }}

<!-- Disabled Services Banner - Replaces Hero when services are disabled -->
<!-- Collapsed by default, shown only when there are disabled services -->
<section class="disabled-services-banner" id="disabledServicesBanner" style="display: none;">
    <div class="container">
        <button class="disabled-banner-toggle" id="disabledBannerToggle" aria-expanded="false">
            <span class="disabled-banner-icon">⚠</span>
            <span class="disabled-banner-text">Disabled Services</span>
            <span class="disabled-banner-count" id="disabledBannerCount">(0)</span>
            <span class="disabled-banner-chevron">▼</span>
        </button>
        
        <div class="disabled-banner-content" id="disabledBannerContent" style="display: none;">
            <p class="disabled-banner-subtitle">These services are turned off to save resources. Click "Enable" to start them.</p>
            <div class="service-grid disabled-services-grid" id="disabledServicesGrid">
                <!-- Populated dynamically by ServiceManagerAPI -->
            </div>
        </div>
    </div>
</section>

<!-- Status Banner -->
<div class="status-banner" id="statusBanner">
    <span class="status-dot"></span>
    <span id="statusText">Checking services...</span>
</div>

<!-- Services Section -->
<main class="services-section container" id="services">
    <h2>Your Offline Services</h2>
    <p class="section-subtitle">Everything running on this device — no internet required</p>
    
    <!-- Search/Filter - With Icon -->
    <div class="services-filter">
        <div class="search-wrapper">
            <img src="/images/icons/ui-search.svg" alt="" class="search-icon">
            <input type="text" 
                   id="serviceSearch" 
                   class="search-input" 
                   placeholder="Search services..."
                   autocomplete="off">
        </div>
    </div>

    {{- $services := .Site.Params.services }}

    <!-- START HERE - Curated essentials for new users -->
    <div class="start-here">
        <h3 class="category-title"><img src="/images/icons/ui-star.svg" alt="" class="category-icon"> Start Here</h3>
        <p class="quick-start-subtitle">The essentials — tap any tile to open</p>
        <div class="service-grid start-here-grid">
            {{- /* Wikipedia */ -}}
            {{- with index $services.knowledge.items 0 }}
            {{- $isDemo := hasPrefix site.BaseURL "https://demo." }}
            {{- $linkUrl := cond (and $isDemo .demo_url) .demo_url .url }}
            <a href="{{ $linkUrl }}" target="_blank" class="service-card" data-service="{{ .service }}" data-container="{{ .container | default .service }}" data-tooltip="{{ .description }}">
                <div class="service-icon">
                    {{- if .icon }}
                    <img src="{{ .icon }}" alt="" loading="lazy" onerror="this.style.display='none'; this.parentElement.innerHTML='{{ .fallback }}';">
                    {{- else }}
                    {{ .fallback }}
                    {{- end }}
                </div>
                <div class="service-info">
                    <h3>{{ .name }}</h3>
                    <p>{{ .description }}</p>
                </div>
                <div class="service-status checking"></div>
            </a>
            {{- end }}
            
            {{- /* Maps */ -}}
            {{- with index $services.knowledge.items 1 }}
            {{- $isDemo := hasPrefix site.BaseURL "https://demo." }}
            {{- $linkUrl := cond (and $isDemo .demo_url) .demo_url .url }}
            <a href="{{ $linkUrl }}" target="_blank" class="service-card" data-service="{{ .service }}" data-container="{{ .container | default .service }}" data-tooltip="{{ .description }}">
                <div class="service-icon">
                    {{- if .icon }}
                    <img src="{{ .icon }}" alt="" loading="lazy" onerror="this.style.display='none'; this.parentElement.innerHTML='{{ .fallback }}';">
                    {{- else }}
                    {{ .fallback }}
                    {{- end }}
                </div>
                <div class="service-info">
                    <h3>{{ .name }}</h3>
                    <p>{{ .description }}</p>
                </div>
                <div class="service-status checking"></div>
            </a>
            {{- end }}
            
            {{- /* AI Chat */ -}}
            {{- with index $services.ai.items 1 }}
            {{- $isDemo := hasPrefix site.BaseURL "https://demo." }}
            {{- $linkUrl := cond (and $isDemo .demo_url) .demo_url .url }}
            <a href="{{ $linkUrl }}" target="_blank" class="service-card" data-service="{{ .service }}" data-container="{{ .container | default .service }}" data-tooltip="{{ .description }}">
                <div class="service-icon">
                    {{- if .icon }}
                    <img src="{{ .icon }}" alt="" loading="lazy" onerror="this.style.display='none'; this.parentElement.innerHTML='{{ .fallback }}';">
                    {{- else }}
                    {{ .fallback }}
                    {{- end }}
                </div>
                <div class="service-info">
                    <h3>{{ .name }}</h3>
                    <p>{{ .description }}</p>
                </div>
                <div class="service-status checking"></div>
            </a>
            {{- end }}
            
            {{- /* File Browser */ -}}
            {{- with index $services.files.items 0 }}
            {{- $isDemo := hasPrefix site.BaseURL "https://demo." }}
            {{- $linkUrl := cond (and $isDemo .demo_url) .demo_url .url }}
            <a href="{{ $linkUrl }}" target="_blank" class="service-card" data-service="{{ .service }}" data-container="{{ .container | default .service }}" data-tooltip="{{ .description }}">
                <div class="service-icon">
                    {{- if .icon }}
                    <img src="{{ .icon }}" alt="" loading="lazy" onerror="this.style.display='none'; this.parentElement.innerHTML='{{ .fallback }}';">
                    {{- else }}
                    {{ .fallback }}
                    {{- end }}
                </div>
                <div class="service-info">
                    <h3>{{ .name }}</h3>
                    <p>{{ .description }}</p>
                </div>
                <div class="service-status checking"></div>
            </a>
            {{- end }}
        </div>
    </div>

    <!-- Recently Used - Compact, dynamic section -->
    <div class="quick-start">
        <h3 class="category-title"><img src="/images/icons/stat-uptime.svg" alt="" class="category-icon"> Recently Used</h3>
        <p class="quick-start-subtitle">Your recently accessed services</p>
        
        <!-- Empty state - shown when no recently used services -->
        <div class="recently-used-empty" id="recentlyUsedEmpty">
            <p>Services you use will appear here for quick access</p>
        </div>
        
        <!-- Dynamic grid - populated by JavaScript -->
        <div class="service-grid quick-grid" id="recentlyUsedGrid" style="display: none;">
            <!-- Populated dynamically by RecentlyUsedManager -->
        </div>
    </div>

    <!-- All Service Categories -->
    {{ partial "service-category.html" (dict "category" $services.ai "icon" "/images/icons/cat-ai.svg") }}
    {{ partial "service-category.html" (dict "category" $services.knowledge "icon" "/images/icons/cat-knowledge.svg") }}
    {{ partial "service-category.html" (dict "category" $services.collaboration "icon" "/images/icons/cat-collaboration.svg") }}
    {{ partial "service-category.html" (dict "category" $services.security "icon" "/images/icons/cat-security.svg") }}
    {{ partial "service-category.html" (dict "category" $services.files "icon" "/images/icons/cat-files.svg") }}
    {{ partial "service-category.html" (dict "category" $services.communication "icon" "/images/icons/cat-communication.svg") }}
    {{ partial "service-category.html" (dict "category" $services.tools "icon" "/images/icons/cat-tools.svg") }}

    <!-- Advanced Section Toggle -->
    <div class="advanced-toggle">
        <button id="advancedToggle" class="toggle-btn">
            <img src="/images/icons/ui-chevron.svg" alt="" class="toggle-icon"> Show Admin Tools
        </button>
    </div>
    
    <div class="advanced-section" id="advancedSection" style="display: none;">
        {{ partial "service-category.html" (dict "category" $services.infrastructure "icon" "/images/icons/cat-infrastructure.svg") }}
        {{ partial "service-category.html" (dict "category" $services.admin "icon" "/images/icons/cat-admin.svg") }}
    </div>

</main>

{{ end }}
